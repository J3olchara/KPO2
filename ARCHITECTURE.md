# Архитектура системы текстового сканера

## Общее описание
Система представляет собой микросервисное приложение для анализа текстовых отчетов. Система выполняет следующие функции:
1. Загрузка и хранение текстовых файлов
2. Анализ статистики текста (количество абзацев, слов, символов)
3. Сравнение файлов на схожесть для выявления плагиата
4. Визуализация данных в виде облака слов

## Компоненты системы

### 1. API Gateway (Nginx)
- **Назначение**: Маршрутизация запросов к соответствующим микросервисам
- **Технологии**: Nginx
- **Endpoints**:
  - `/api/files/*` → File Storing Service
  - `/api/analysis/*` → File Analysis Service
  - `/api/docs` → Статическая документация API

### 2. File Storing Service
- **Назначение**: Управление хранением и выдачей файлов
- **Технологии**: Java, Spring Boot, PostgreSQL, JPA
- **Ответственность**:
  - Сохранение загруженных файлов в файловой системе
  - Хранение метаданных о файлах в базе данных
  - Предоставление доступа к файлам по запросу
  - Управление жизненным циклом файлов (загрузка, удаление)
- **Эндпоинты**:
  - `POST /api/files/upload` - Загрузка файла
  - `GET /api/files/{fileId}` - Получение содержимого файла
  - `GET /api/files` - Получение списка всех файлов
  - `DELETE /api/files/{fileId}` - Удаление файла

### 3. File Analysis Service
- **Назначение**: Анализ текстовых файлов и хранение результатов анализа
- **Технологии**: Java, Spring Boot, PostgreSQL, JPA, WebClient
- **Ответственность**:
  - Анализ статистики текста (подсчет абзацев, слов, символов)
  - Сравнение файлов на схожесть
  - Генерация облака слов через внешнее API
  - Хранение результатов анализа
- **Эндпоинты**:
  - `POST /api/analysis/stats/{fileId}` - Анализ статистики текста
  - `GET /api/analysis/stats/{fileId}` - Получение статистики текста
  - `POST /api/analysis/similarity/{fileId}` - Анализ схожести с другими файлами
  - `GET /api/analysis/similarity/{fileId}` - Получение результатов анализа схожести
  - `GET /api/analysis/wordcloud/{fileId}` - Генерация облака слов

## Взаимодействие между компонентами

### Загрузка файла
1. Пользователь отправляет файл через API Gateway
2. API Gateway маршрутизирует запрос к File Storing Service
3. File Storing Service проверяет файл, сохраняет его и возвращает метаданные

### Анализ файла
1. Пользователь запрашивает анализ через API Gateway
2. API Gateway маршрутизирует запрос к File Analysis Service
3. File Analysis Service запрашивает содержимое файла у File Storing Service
4. File Analysis Service выполняет анализ и сохраняет результаты
5. File Analysis Service возвращает результаты анализа

### Получение облака слов
1. Пользователь запрашивает облако слов через API Gateway
2. API Gateway маршрутизирует запрос к File Analysis Service
3. File Analysis Service запрашивает содержимое файла у File Storing Service
4. File Analysis Service обращается к внешнему API для генерации облака слов
5. File Analysis Service возвращает изображение облака слов

## Обработка ошибок
- Все микросервисы имеют механизмы обработки ошибок
- При недоступности File Storing Service, File Analysis Service возвращает соответствующую ошибку
- API Gateway настроен на обработку ошибок от микросервисов с возвратом соответствующих HTTP-статусов

## Масштабирование
- Каждый микросервис может быть развернут в нескольких экземплярах
- База данных может быть вынесена в отдельные кластеры
- API Gateway может балансировать нагрузку между экземплярами микросервисов

## Тестирование
В проекте реализовано комплексное тестирование с высоким покрытием кода (более 65%):

### Типы тестов
- **Модульные тесты (Unit Tests)**: тестирование отдельных классов и методов
- **Интеграционные тесты**: тестирование взаимодействия компонентов
- **API тесты**: тестирование REST API с помощью MockMvc

### Используемые инструменты
- **JUnit 5**: основной фреймворк тестирования
- **Mockito**: для создания моков и заглушек
- **JaCoCo**: для оценки покрытия кода тестами
- **H2 Database**: встроенная база данных для тестирования
- **MockMvc**: для тестирования REST контроллеров
- **WebTestClient**: для тестирования реактивных компонентов

### Стратегия тестирования
1. **File Storing Service**:
   - Тестирование хранения и извлечения файлов
   - Проверка корректной работы с метаданными
   - Обработка ошибок при работе с файлами

2. **File Analysis Service**:
   - Тестирование алгоритмов анализа текста
   - Проверка сравнения файлов на схожесть
   - Корректная интеграция с File Storing Service
   - Обработка ошибок при недоступности File Storing Service 